@page "/agregar-donante"
@page "/agregar-donante/{Id:int}"
@rendermode InteractiveServer
@using Microsoft.EntityFrameworkCore
@using Veterinaria.Models
@inject VeterinariaDbContext DbContext
@inject NavigationManager Navigation

<div class="container" style="max-width: 600px;">
    <div class="card shadow border-0">
        <div class="card-header bg-success text-white py-3">
            <h3 class="mb-0">
                <i class="bi bi-heart-fill me-2"></i>
                @(Id.HasValue ? "Editar Mecenas" : "Registrar Mecenas")
            </h3>
        </div>
        <div class="card-body p-4">
            <EditForm Model="@donante" OnValidSubmit="Guardar" FormName="FormDonante">
                <DataAnnotationsValidator />

                <div class="mb-4">
                    <label class="form-label fw-bold">Nombre Completo</label>
                    <InputText class="form-control" @bind-Value="donante.NombreCompleto" required placeholder="Ej: Empresa Solidaria S.A." />
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold text-success">Compromiso Mensual (Bs)</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">Bs.</span>
                        <InputNumber class="form-control" @bind-Value="donante.CompromisoMontoMensual" placeholder="0.00" />
                    </div>
                    <div class="form-text">Monto fijo que el mecenas promete donar cada mes.</div>
                </div>

                <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
                    <button type="button" class="btn btn-secondary" @onclick="Cancelar">Cancelar</button>
                    <button type="submit" class="btn btn-success fw-bold">
                        <i class="bi bi-save me-2"></i>Guardar Datos
                    </button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code {
    [Parameter] public int? Id { get; set; }
    [SupplyParameterFromForm] private Donante donante { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue && donante.IdDonante == 0)
        {
            var encontrado = await DbContext.Donantes.FindAsync(Id.Value);
            if (encontrado != null) donante = encontrado;
        }
    }

    private async Task Guardar()
    {
        if (Id.HasValue && Id.Value > 0)
            DbContext.Donantes.Update(donante);
        else
            DbContext.Donantes.Add(donante);

        await DbContext.SaveChangesAsync();
        Navigation.NavigateTo("/donantes");
    }

    private void Cancelar() => Navigation.NavigateTo("/donantes");
}